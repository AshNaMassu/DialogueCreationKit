@using DialogueCreationKit.DialogueKit.Enums;
@using DialogueCreationKit.DialogueKit.Managers;
@using DialogueCreationKit.DialogueKit.Models;
@using DialogueCreationKit.DialogueKit.Models.View;

<style>
    .message {
        padding: 8px;
        border-width: 1px;
        border-style: outset;
        border-color: #00000010;
        box-shadow: 0px 0px 10px 1px #00000040;
        margin-bottom: 4px;
        margin-top: 4px;
        /*background-color: #ffffff;*/
    }

    .message .header {
        display: flex; 
        flex-direction: row;
        align-items: center;
        border-bottom: 1px dashed #00000020;
        padding-bottom: 8px;
    }

    .message .header .avatar {
        margin-right: 8px;
        min-width: 32px;
    }

    .message .header .title {
        /*margin-left: 8px;*/
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
    }

    .message .header .title .name{
        color: rgba(0, 0, 0, 0.85);
        font-size: 16px;
        margin-bottom: 0;
    }

    .message .header .title .id {
        color: rgba(0, 0, 0, 0.45);
        font-size: 14px;
    }

    .mr-8,
    .message .header .title {
        margin-right: 8px;
    }

    .ml-8,
    .message .header .title {
        margin-left: 8px;
    }
</style>

@if (_model.Mode == DialogueCreateMode.Dialogue)
{
    <li class="message" id="@Message.Id" style="background: @(GetColor())" @onclick=OnMessageClick>
        <div draggable="true" @ondrop="e=>DragAndDropManager.OnDrop(_model, e, Message.Id)" @ondragstart="e=>DragAndDropManager.OnDragStart(e, Message.Id)" ondragover="event.preventDefault()">
            <div class="header">
                <Avatar Style=@(_isActor ? colorAvatar0 : colorAvatar1) Class="avatar">
                    @(
                        _isActor ? _model.ActorName[0] : _model.Companion.Name[0]
                        )
                </Avatar>
                <div class="title">
                    <h4 class="name ml-8">
                        @(
                            _isActor ? _model.ActorName : _model.Companion.Name
                            )
                    </h4>
                    @if (!IsCheckedMessageMode && _stage.Stage == DialogueStage.Content && _isActor && Message.Id > 3)
                    {
                        <Checkbox @bind-Checked=@_stage.IsNewTheme>Новая тема</Checkbox>
                    }
                </div>
            </div>
            <div>
                <TextArea AutoSize MaxRows="2" Value="@Message.Message" DebounceMilliseconds="10" OnChange="OnMessageChanged" />
            </div>
        </div>
    </li>
}
else
{
    <li class="message" id="@Message.Id" style="background: #ffffff">
        <div draggable="true" @ondrop="e=>DragAndDropManager.OnDrop(_model, e, Message.Id)" @ondragstart="e=>DragAndDropManager.OnDragStart(e, Message.Id)" ondragover="event.preventDefault()">
            <div>
                <TextArea AutoSize MaxRows="2" Value="@Message.Message" DebounceMilliseconds="10" OnChange="OnMessageChanged" />
            </div>
        </div>
    </li>
}
